<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kit de Seguridad PsicolÃ³gica</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #e8eef3 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; }
        .hero-boat { width: 100%; max-width: 500px; margin: 10px auto 20px; padding: 30px; background: linear-gradient(135deg, #e8f4f8 0%, #b8dde6 50%, #7ec8d3 100%); border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .simple-boat { font-size: 5em; animation: floating 3s ease-in-out infinite; text-align: center; }
        @keyframes floating { 0%, 100% { transform: translateY(0) rotate(-2deg); } 50% { transform: translateY(-15px) rotate(2deg); } }
        .boat-text { text-align: center; color: #5a6c7d; margin-top: 15px; }
        h1 { color: #2c3e50; font-size: 2em; margin-bottom: 8px; }
        .subtitle { color: #5a6c7d; margin-bottom: 20px; }
        .meeting-phase, .voice-meter, .quick-actions, .truth-cards-section { background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .phase-selector { display: flex; gap: 10px; flex-wrap: wrap; }
        .phase-btn { flex: 1; min-width: 150px; padding: 15px 20px; border: 3px solid transparent; border-radius: 12px; font-size: 1em; font-weight: bold; cursor: pointer; background: #f8f9fa; color: #5a6c7d; transition: all 0.3s; }
        .phase-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .phase-btn.active { transform: scale(1.05); }
        .phase-btn.inicio.active { background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); color: white; }
        .phase-btn.durante.active { background: linear-gradient(135deg, #f7b733 0%, #ffd93d 100%); color: #333; }
        .phase-btn.cierre.active { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
        .interactive-workspace { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        .color-cards-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .voice-card { padding: 25px 15px; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s; border: 3px solid transparent; }
        .voice-card:hover { transform: translateY(-5px) scale(1.03); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .voice-card.selected { transform: scale(1.08); border-width: 4px; box-shadow: 0 15px 40px rgba(0,0,0,0.3); }
        .voice-card.green { background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); color: white; }
        .voice-card.green.selected { border-color: #56ab2f; }
        .voice-card.yellow { background: linear-gradient(135deg, #f7b733 0%, #ffd93d 100%); color: #333; }
        .voice-card.yellow.selected { border-color: #f7b733; }
        .voice-card.orange { background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); color: white; }
        .voice-card.orange.selected { border-color: #ff6b35; }
        .card-icon { font-size: 2.5em; margin-bottom: 10px; }
        .card-title { font-weight: bold; font-size: 1.1em; margin-bottom: 8px; }
        .card-desc { font-size: 0.85em; }
        .action-btn { width: 100%; padding: 18px; margin-bottom: 12px; border: none; border-radius: 12px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .action-btn:hover { transform: translateX(5px); box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .action-btn.spray { background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%); color: #2c3e50; }
        .action-btn.faro { background: linear-gradient(135deg, #a8322d 0%, #d66860 100%); color: white; }
        
        /* Floating music icon */
        .music-float-icon {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            border: 3px solid white;
        }
        
        .music-float-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
        }
        
        .music-float-icon.playing {
            animation: musicPulse 1.5s ease-in-out infinite;
            background: linear-gradient(135deg, #19547b 0%, #ffd89b 100%);
        }
        
        @keyframes musicPulse { 
            0%, 100% { transform: scale(1); } 
            50% { transform: scale(1.1); } 
        }
        
        /* Floating voice icon */
        .voice-float-icon {
            position: fixed;
            bottom: 30px;
            right: 110px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            border: 3px solid white;
        }
        
        .voice-float-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
        }
        
        .voice-float-icon.speaking {
            animation: voicePulse 0.8s ease-in-out infinite;
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        
        @keyframes voicePulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        /* Language selector icon */
        .language-float-icon {
            position: fixed;
            bottom: 30px;
            right: 190px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            border: 3px solid white;
        }
        
        .language-float-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
        }
        
        .language-menu {
            position: fixed;
            bottom: 100px;
            right: 190px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            padding: 15px;
            display: none;
            z-index: 999;
            min-width: 200px;
        }
        
        .language-menu.active {
            display: block;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .language-option {
            padding: 12px 15px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }
        
        .language-option:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }
        
        .language-option.selected {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        @media (max-width: 768px) {
            .music-float-icon { bottom: 20px; right: 20px; width: 50px; height: 50px; font-size: 1.5em; }
            .voice-float-icon { bottom: 20px; right: 85px; width: 50px; height: 50px; font-size: 1.5em; }
            .language-float-icon { bottom: 20px; right: 150px; width: 50px; height: 50px; font-size: 1.5em; }
            .language-menu { bottom: 80px; right: 150px; min-width: 180px; }
        }
        .action-btn.bloom { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .mode-btn { padding: 10px 20px; border: 2px solid #e0e0e0; border-radius: 8px; background: white; cursor: pointer; font-weight: 600; color: #5a6c7d; transition: all 0.3s; }
        .mode-btn:hover { transform: translateY(-2px); }
        .mode-btn.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .questions-grid { display: grid; gap: 15px; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
        .question-card { background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 12px; cursor: pointer; transition: all 0.4s; position: relative; border: 2px solid transparent; min-height: 100px; display: flex; align-items: center; justify-content: center; text-align: center; font-weight: 500; }
        .question-card::before { content: ''; position: absolute; top: 0; left: 0; width: 6px; height: 100%; }
        .question-card:hover { transform: translateY(-8px) scale(1.03); box-shadow: 0 15px 35px rgba(0,0,0,0.15); }
        .question-card.inicio::before { background: linear-gradient(180deg, #56ab2f 0%, #a8e063 100%); }
        .question-card.inicio:hover { border-color: #56ab2f; background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%); }
        .question-card.durante::before { background: linear-gradient(180deg, #f7b733 0%, #ffd93d 100%); }
        .question-card.durante:hover { border-color: #f7b733; background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); }
        .question-card.cierre::before { background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%); }
        .question-card.cierre:hover { border-color: #4facfe; background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%); }
        .question-phase-badge { position: absolute; top: 10px; left: 10px; padding: 4px 12px; border-radius: 20px; font-size: 0.75em; font-weight: bold; text-transform: uppercase; }
        .question-phase-badge.inicio { background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); color: white; }
        .question-phase-badge.durante { background: linear-gradient(135deg, #f7b733 0%, #ffd93d 100%); color: #333; }
        .question-phase-badge.cierre { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
        .recognition-section { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 15px; padding: 30px; color: white; box-shadow: 0 5px 20px rgba(0,0,0,0.15); }
        .shared-notice { background: rgba(255,255,255,0.2); padding: 12px 18px; border-radius: 10px; margin-bottom: 20px; font-size: 0.9em; }
        .recognition-input-group { display: flex; gap: 10px; margin-bottom: 25px; }
        .recognition-input-group input { flex: 1; padding: 15px; border: none; border-radius: 10px; font-size: 1em; }
        .recognition-input-group button { padding: 15px 30px; background: white; color: #4facfe; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .recognition-input-group button:hover:not(:disabled) { transform: scale(1.05); }
        .recognition-input-group button:disabled { opacity: 0.5; cursor: not-allowed; }
        .recognition-list { display: grid; gap: 12px; max-height: 400px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .recognition-item { background: rgba(255,255,255,0.2); padding: 18px; border-radius: 10px; border-left: 4px solid white; display: flex; justify-content: space-between; align-items: center; gap: 15px; animation: slideIn 0.5s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
        .recognition-text { flex: 1; word-break: break-word; }
        .delete-btn { background: #e74c3c; color: white; border: none; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; white-space: nowrap; }
        .delete-btn:hover:not(:disabled) { background: #c0392b; transform: scale(1.08); }
        .delete-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 20px; padding: 40px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .modal-content h3 { color: #2c3e50; margin-bottom: 20px; font-size: 1.8em; }
        .modal-content h4 { color: #2c3e50; margin-top: 20px; margin-bottom: 10px; }
        .modal-content p { color: #5a6c7d; line-height: 1.8; margin-bottom: 15px; }
        .modal-content .kit-item { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #4facfe; }
        .close-modal { background: #e74c3c; color: white; border: none; padding: 12px 25px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 20px; transition: all 0.3s; }
        .close-modal:hover { background: #c0392b; transform: scale(1.05); }
        .spray-effect { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 10em; opacity: 0; pointer-events: none; transition: all 1.5s; z-index: 999; width: 100%; max-width: 300px; display: flex; justify-content: center; align-items: center; }
        .spray-effect.active { opacity: 0.4; }
        .spray-message { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(168, 230, 207, 0.95); padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); opacity: 0; pointer-events: none; transition: all 0.5s; z-index: 998; text-align: center; max-width: 500px; width: 90%; }
        .spray-message.active { opacity: 1; }
        .spray-message h3 { color: #2c3e50; margin-bottom: 10px; font-size: 1.3em; }
        .spray-message p { color: #5a6c7d; font-size: 0.95em; }
        @media (max-width: 1024px) { 
            .interactive-workspace { grid-template-columns: 1fr; } 
            .questions-grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); }
        }
        @media (max-width: 768px) { 
            .color-cards-grid { grid-template-columns: 1fr; } 
            .phase-selector { flex-direction: column; }
            .questions-grid { grid-template-columns: 1fr; }
            .recognition-item { flex-direction: column; align-items: flex-start; }
            .delete-btn { align-self: flex-end; width: 100%; margin-top: 10px; }
            .modal-content { padding: 25px; max-height: 85vh; }
            h1 { font-size: 1.5em; }
            .hero-boat { padding: 20px; }
            .simple-boat { font-size: 3.5em; }
            .meeting-phase, .voice-meter, .quick-actions, .truth-cards-section, .recognition-section { padding: 20px; }
            .recognition-input-group { flex-direction: column; }
            .recognition-input-group button { width: 100%; }
        }
        @media (max-width: 480px) {
            body { padding: 10px; }
            .phase-btn { min-width: 100px; padding: 12px 15px; font-size: 0.9em; }
            .voice-card { padding: 20px 10px; }
            .card-icon { font-size: 2em; }
            .card-title { font-size: 1em; }
            .action-btn { padding: 15px; font-size: 0.95em; }
            .question-card { padding: 20px; min-height: 80px; font-size: 0.95em; }
            .modal-content { padding: 20px; }
            .modal-content h3 { font-size: 1.4em; }
            .kit-item { padding: 12px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§  Kit de Seguridad PsicolÃ³gica</h1>
            <p class="subtitle">PequeÃ±os gestos para grandes conversaciones</p>
            <div class="hero-boat">
                <div class="simple-boat">â›µ</div>
                <p class="boat-text">Navegando juntos hacia conversaciones mÃ¡s seguras</p>
            </div>
        </header>
        
        <div class="meeting-phase" role="region" aria-label="Fase de la ReuniÃ³n">
            <h2 style="color: #2c3e50; margin-bottom: 10px;">ğŸ“ Fase de la ReuniÃ³n</h2>
            <p style="color: #5a6c7d; margin-bottom: 15px;">No tienes que usar todo a la vez â€” elige lo que el equipo necesite ese dÃ­a</p>
            <div class="phase-selector" role="group" aria-label="Seleccionar fase de la reuniÃ³n">
                <button class="phase-btn inicio active" onclick="setPhase('inicio')">ğŸŸ¢ Inicio</button>
                <button class="phase-btn durante" onclick="setPhase('durante')">ğŸŸ¡ Durante</button>
                <button class="phase-btn cierre" onclick="setPhase('cierre')">ğŸ”µ Cierre</button>
            </div>
        </div>
        
        <div class="interactive-workspace">
            <div class="voice-meter" role="region" aria-label="Tarjetas de Colores">
                <h2>ğŸŒˆ Tarjetas de Colores</h2>
                <p style="color: #5a6c7d; margin-bottom: 20px;">Â¿Quieres decir algo sin interrumpir? Usa una tarjeta para mantener la conversaciÃ³n fluida y respetuosa</p>
                <div class="color-cards-grid" role="group" aria-label="Seleccionar tarjeta de color">
                    <div class="voice-card green" onclick="selectVoiceCard(this, 'green')">
                        <div class="card-icon">ğŸŸ¢</div>
                        <div class="card-title">Verde</div>
                        <div class="card-desc">Estoy escuchando atentamente</div>
                    </div>
                    <div class="voice-card yellow" onclick="selectVoiceCard(this, 'yellow')">
                        <div class="card-icon">ğŸŸ¡</div>
                        <div class="card-title">Amarillo</div>
                        <div class="card-desc">Tengo una pregunta</div>
                    </div>
                    <div class="voice-card orange" onclick="selectVoiceCard(this, 'orange')">
                        <div class="card-icon">ğŸŸ </div>
                        <div class="card-title">Naranja</div>
                        <div class="card-desc">Reformulemos esto</div>
                    </div>
                </div>
            </div>
            
            <div class="quick-actions" role="region" aria-label="Acciones RÃ¡pidas">
                <h2>âš¡ Acciones RÃ¡pidas</h2>
                <button class="action-btn spray" onclick="activateBreathing()" aria-label="Activar pausa de respiraciÃ³n guiada">ğŸ§˜ Pausa de RespiraciÃ³n</button>
                <button class="action-btn faro" onclick="showFaro()" aria-label="Abrir guÃ­a del faro">ğŸŒŸ El Faro - Tu GuÃ­a</button>
                <button class="action-btn bloom" onclick="showBloom()" aria-label="Acceder a recursos de Bloom">ğŸ“± Curso Bloom</button>
            </div>
        </div>
        
        <div class="truth-cards-section" role="region" aria-label="Cartas de la Verdad">
            <h2>ğŸƒ Cartas de la Verdad</h2>
            <p style="color: #5a6c7d; margin-bottom: 15px;">PequeÃ±as frases para grandes conversaciones. Haz clic para copiar al portapapeles</p>
            <div class="cards-display-mode" role="group" aria-label="Modo de visualizaciÃ³n de cartas">
                <button class="mode-btn active" onclick="setCardMode('all')">ğŸ“š Ver Todas</button>
                <button class="mode-btn" onclick="setCardMode('current')">ğŸ¯ Fase Actual</button>
                <button class="mode-btn" onclick="shuffleCards()">ğŸ”€ Mezclar</button>
            </div>
            <div id="questionsContainer" class="questions-grid"></div>
        </div>
        
        <div class="recognition-section" role="region" aria-label="Tablero de Reconocimiento">
            <h2>ğŸ’Œ Tablero de Reconocimiento</h2>
            <p style="margin-bottom: 15px;">Al final de la reuniÃ³n, escribe un pequeÃ±o agradecimiento. PequeÃ±os gestos refuerzan la confianza y el sentido de equipo.</p>
            <div class="recognition-input-group">
                <input type="text" id="recognitionInput" placeholder='Ej: "Gracias por escuchar con paciencia"' maxlength="200" aria-label="Escribe tu reconocimiento aquÃ­" />
                <button id="addBtn" onclick="addRecognition()" aria-label="Agregar reconocimiento al tablero">Agregar ğŸ’š</button>
            </div>
            <div id="recognitionList" class="recognition-list" role="list" aria-label="Lista de reconocimientos">
                <div style="text-align: center; padding: 20px;">â³ Cargando...</div>
            </div>
        </div>
    </div>
    
    <div id="faroModal" class="modal">
        <div class="modal-content">
            <h3>ğŸŒŸ El Faro: tu guÃ­a para crear espacios seguros</h3>
            
            <p><strong id="faroWhatIsTitle">Â¿QuÃ© es El Faro?</strong><br>
            <span id="faroWhatIsDesc">Es una pequeÃ±a guÃ­a que te ayuda a recordar por quÃ© existe el kit, cÃ³mo usarlo y cÃ³mo cada elemento puede ayudarte a cuidar la seguridad psicolÃ³gica del grupo.</span></p>
            
            <h4 id="faroWhyTitle">ğŸ’¬ Â¿Por quÃ© existe este kit?</h4>
            <p id="faroWhyDesc1">Porque en Takeda creemos que la seguridad psicolÃ³gica no nace de grandes discursos, sino de pequeÃ±os gestos: cÃ³mo escuchamos, cÃ³mo preguntamos, y cÃ³mo damos espacio a las ideas de los demÃ¡s.</p>
            <p id="faroWhyDesc2">Este kit estÃ¡ aquÃ­ para acompaÃ±arte en esos momentos, fortalecer la confianza y crear reuniones donde todos puedan hablar con libertad, respeto y serenidad.</p>
            
            <h4 id="faroContainsTitle">ğŸ Â¿QuÃ© contiene?</h4>
            <p id="faroContainsDesc" style="margin-bottom: 20px;">Cada elemento tiene un propÃ³sito especial:</p>
            
            <div class="kit-item" id="faroColorCardsItem">
                <strong>ğŸŒˆ Tarjetas de colores</strong><br>
                Â¿Quieres decir algo sin interrumpir? Usa una tarjeta. Te ayudan a mantener la conversaciÃ³n fluida y respetuosa.
            </div>
            
            <div class="kit-item" id="faroTruthCardsItem">
                <strong>ğŸ’Œ Cartas de la verdad</strong><br>
                Â¿Sientes que tu equipo necesita reflexionar o empatizar? Elige una carta: cada una invita a pensar y conectar desde la emociÃ³n.
            </div>
            
            <div class="kit-item" id="faroRecognitionItem">
                <strong>â­ Tablero de reconocimiento</strong><br>
                Â¿Quieres cerrar con gratitud? Escribe un agradecimiento o algo positivo que notaste durante la reuniÃ³n. Â¡Reconocer fortalece la confianza!
            </div>
            
            <div class="kit-item" id="faroBloomItem">
                <strong>ğŸ“± Tarjeta QR de Bloom</strong><br>
                Â¿Te gustarÃ­a seguir aprendiendo sobre seguridad psicolÃ³gica? EscanÃ©ala y descubre mÃ¡s recursos e ideas.
            </div>
            
            <div class="kit-item" id="faroBreathingItem">
                <strong>ğŸ§˜ Pausa de RespiraciÃ³n</strong><br>
                Â¿Necesitas un momento para respirar antes de comenzar? Usa la pausa de respiraciÃ³n guiada para marcar el inicio y centrar la energÃ­a del grupo en el espacio virtual.
            </div>
            
            <h4 id="faroHowTitle">ğŸª„ Â¿CÃ³mo se usa?</h4>
            <p id="faroHowDesc" style="margin-bottom: 20px;">Este kit estÃ¡ hecho para reuniones reales: cortas, con muchas ideas y poco tiempo.<br>
            No tienes que usar todo a la vez â€”elige lo que el equipo necesite ese dÃ­aâ€”.</p>
            
            <p><strong id="faroStartTitle">ğŸ’­ Â¿Vas a empezar una reuniÃ³n?</strong><br>
            <span id="faroStartDesc">Crea el ambiente. Usa la pausa de respiraciÃ³n para marcar el inicio y elige una carta con una pregunta o emociÃ³n.</span></p>
            
            <p><strong id="faroDuringTitle">ğŸ‘‚ Â¿EstÃ¡n en plena conversaciÃ³n?</strong><br>
            <span id="faroDuringDesc">ApÃ³yate en las tarjetas de colores o en las cartas de la verdad. Sirven para expresar, pedir la palabra o aclarar ideas sin romper la armonÃ­a.</span></p>
            
            <p><strong id="faroEndTitle">ğŸ’– Â¿Es momento de cerrar?</strong><br>
            <span id="faroEndDesc">TÃ³mate un minuto para agradecer o reconocer algo positivo. Usa el tablero o una carta de cierre para reflexionar sobre lo aprendido.</span></p>
            
            <h4 id="faroRememberTitle">ğŸ’¡ Recuerda</h4>
            <p id="faroRememberDesc">Usar el kit no es cambiar la forma de trabajar, sino mejorar cÃ³mo nos escuchamos. Con el tiempo, estas pequeÃ±as acciones hacen que las reuniones sean mÃ¡s seguras, mÃ¡s humanas y mucho mÃ¡s efectivas.</p>
            
            <button class="close-modal" onclick="closeModal('faroModal')">Cerrar</button>
        </div>
    </div>
    
    <div id="bloomModal" class="modal">
        <div class="modal-content">
            <h3 id="bloomTitle">ğŸ§ Seguridad PsicolÃ³gica en Bloom</h3>
            <p id="bloomDesc1">AmplÃ­a tus conocimientos sobre seguridad psicolÃ³gica con nuestros recursos y cursos en Bloom.</p>
            <div style="text-align: center; margin: 30px 0;">
                <a href="https://takeda.edcast.com/smartsearch?q=Seguridad+psicologica" target="_blank" style="text-decoration: none;">
                    <div style="width: 150px; height: 150px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0 auto; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 4em; cursor: pointer; transition: all 0.3s; box-shadow: 0 5px 20px rgba(0,0,0,0.2);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">ğŸ“š</div>
                    <p style="margin-top: 20px; color: #667eea; font-weight: 600; font-size: 1.1em;" id="bloomClick">Haz clic para acceder a los recursos</p>
                </a>
            </div>
            <p id="bloomDesc2">Descubre herramientas, cursos y recursos para crear espacios donde todos se sientan seguros para compartir ideas y aprender de los errores.</p>
            <button class="close-modal" onclick="closeModal('bloomModal')">Cerrar</button>
        </div>
    </div>
    
    <div class="spray-effect" id="breathingEffect">
        <div style="width: 200px; height: 200px; background: radial-gradient(circle, #a8e6cf 0%, #56ab2f 100%); border-radius: 50%; animation: breathe 4s ease-in-out infinite;"></div>
    </div>
    <div class="spray-message" id="breathingMessage">
        <h3 id="breathTitle">ğŸ§˜ Pausa de RespiraciÃ³n</h3>
        <p><strong id="breathText">Inhala profundo... Exhala despacio...</strong></p>
        <p style="font-style: italic; margin-top: 10px;" id="breathDesc">TÃ³mate un momento para centrar tu energÃ­a</p>
    </div>
    
    <!-- Floating music icon -->
    <div class="music-float-icon" id="musicIcon" onclick="toggleBackgroundMusic()" title="MÃºsica Ambiental">
        ğŸµ
    </div>
    
    <!-- Floating voice icon -->
    <div class="voice-float-icon" id="voiceIcon" onclick="toggleVoiceReader()" title="Lector de Voz - Accesibilidad">
        ğŸ”Š
    </div>
    
    <!-- Floating language icon -->
    <div class="language-float-icon" id="languageIcon" onclick="toggleLanguageMenu()" title="Cambiar Idioma">
        ğŸŒ
    </div>
    
    <!-- Language menu -->
    <div class="language-menu" id="languageMenu">
        <div class="language-option selected" onclick="changeLanguage('es')" data-lang="es">
            ğŸ‡ªğŸ‡¸ EspaÃ±ol
        </div>
        <div class="language-option" onclick="changeLanguage('en')" data-lang="en">
            ğŸ‡ºğŸ‡¸ English
        </div>
        <div class="language-option" onclick="changeLanguage('pt')" data-lang="pt">
            ğŸ‡§ğŸ‡· PortuguÃªs
        </div>
        <div class="language-option" onclick="changeLanguage('fr')" data-lang="fr">
            ğŸ‡«ğŸ‡· FranÃ§ais
        </div>
        <div class="language-option" onclick="changeLanguage('de')" data-lang="de">
            ğŸ‡©ğŸ‡ª Deutsch
        </div>
        <div class="language-option" onclick="changeLanguage('ja')" data-lang="ja">
            ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª
        </div>
        <div class="language-option" onclick="changeLanguage('zh')" data-lang="zh">
            ğŸ‡¨ğŸ‡³ ä¸­æ–‡
        </div>
    </div>
    
    <style>
        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.5); opacity: 0.8; }
        }
    </style>
    
    <script>
        // Comprehensive translation dictionary
        const translations = {
            es: {
                // Main page elements
                title: "ğŸ§  Kit de seguridad psicolÃ³gica",
                subtitle: "PequeÃ±os gestos para grandes conversaciones",
                boatText: "Navegando juntos hacia conversaciones mÃ¡s seguras",
                phaseTitle: "ğŸ“ Fase de la ReuniÃ³n",
                phaseDesc: "No tienes que usar todo a la vez â€” elige lo que el equipo necesite ese dÃ­a",
                phaseStart: "ğŸŸ¢ Inicio",
                phaseDuring: "ğŸŸ¡ Durante",
                phaseEnd: "ğŸ”µ Cierre",
                colorCardsTitle: "ğŸŒˆ Tarjetas de Colores",
                colorCardsDesc: "Â¿Quieres decir algo sin interrumpir? Usa una tarjeta para mantener la conversaciÃ³n fluida y respetuosa",
                greenCard: "Verde",
                greenDesc: "Estoy escuchando atentamente",
                yellowCard: "Amarillo",
                yellowDesc: "Tengo una pregunta",
                orangeCard: "Naranja",
                orangeDesc: "Reformulemos esto",
                quickActions: "âš¡ Acciones RÃ¡pidas",
                breathBtn: "ğŸ§˜ Pausa de RespiraciÃ³n",
                faroBtn: "ğŸŒŸ El Faro - Tu GuÃ­a",
                bloomBtn: "ğŸ“± Curso Bloom",
                truthCardsTitle: "ğŸƒ Cartas de la Verdad",
                truthCardsDesc: "PequeÃ±as frases para grandes conversaciones. Haz clic para copiar al portapapeles",
                btnAll: "ğŸ“š Ver Todas",
                btnCurrent: "ğŸ¯ Fase Actual",
                btnShuffle: "ğŸ”€ Mezclar",
                recognitionTitle: "ğŸ’Œ Tablero de Reconocimiento",
                recognitionDesc: "Al final de la reuniÃ³n, escribe un pequeÃ±o agradecimiento. PequeÃ±os gestos refuerzan la confianza y el sentido de equipo.",
                recognitionPlaceholder: 'Ej: "Gracias por escuchar con paciencia"',
                addBtn: "Agregar ğŸ’š",
                deleteBtn: "ğŸ—‘ï¸ Eliminar",
                closeBtn: "Cerrar",
                noRecognitions: "No hay reconocimientos aÃºn. Â¡SÃ© el primero!",
                
                // Questions
                q1: "Â¿CÃ³mo nos sentimos hoy?",
                q2: "Â¿QuÃ© es algo pequeÃ±o que te hizo sonreÃ­r esta semana?",
                q3: "Â¿CuÃ¡l es el objetivo de nuestra reuniÃ³n?",
                q4: "Â¿Ya escuchamos todos los puntos de vista?",
                q5: "Â¿Nos estamos haciendo entender?",
                q6: "Â¿Necesitamos algÃºn ejemplo para entender mejor?",
                q7: "Â¿CuÃ¡l es la idea que me llevo de la conversaciÃ³n?",
                q8: "Â¿QuÃ© apreciamos de cÃ³mo nos escuchamos hoy?",
                q9: "Â¿QuÃ© tareas nos llevamos para seguir avanzando?",
                
                // Breathing section
                breathTitle: "ğŸ§˜ Pausa de RespiraciÃ³n",
                breathText: "Inhala profundo... Exhala despacio...",
                breathDesc: "TÃ³mate un momento para centrar tu energÃ­a",
                
                // Modal content - Faro
                faroTitle: "ğŸŒŸ El Faro: tu guÃ­a para crear espacios seguros",
                faroWhatIsTitle: "Â¿QuÃ© es El Faro?",
                faroWhatIsDesc: "Es una pequeÃ±a guÃ­a que te ayuda a recordar por quÃ© existe el kit, cÃ³mo usarlo y cÃ³mo cada elemento puede ayudarte a cuidar la seguridad psicolÃ³gica del grupo.",
                faroWhyTitle: "ğŸ’¬ Â¿Por quÃ© existe este kit?",
                faroWhyDesc1: "Porque en Takeda creemos que la seguridad psicolÃ³gica no nace de grandes discursos, sino de pequeÃ±os gestos: cÃ³mo escuchamos, cÃ³mo preguntamos, y cÃ³mo damos espacio a las ideas de los demÃ¡s.",
                faroWhyDesc2: "Este kit estÃ¡ aquÃ­ para acompaÃ±arte en esos momentos, fortalecer la confianza y crear reuniones donde todos puedan hablar con libertad, respeto y serenidad.",
                faroContainsTitle: "ğŸ Â¿QuÃ© contiene?",
                faroContainsDesc: "Cada elemento tiene un propÃ³sito especial:",
                faroColorCardsItem: "<strong>ğŸŒˆ Tarjetas de colores</strong><br>Â¿Quieres decir algo sin interrumpir? Usa una tarjeta. Te ayudan a mantener la conversaciÃ³n fluida y respetuosa.",
                faroTruthCardsItem: "<strong>ğŸ’Œ Cartas de la verdad</strong><br>Â¿Sientes que tu equipo necesita reflexionar o empatizar? Elige una carta: cada una invita a pensar y conectar desde la emociÃ³n.",
                faroRecognitionItem: "<strong>â­ Tablero de reconocimiento</strong><br>Â¿Quieres cerrar con gratitud? Escribe un agradecimiento o algo positivo que notaste durante la reuniÃ³n. Â¡Reconocer fortalece la confianza!",
                faroBloomItem: "<strong>ğŸ“± Tarjeta QR de Bloom</strong><br>Â¿Te gustarÃ­a seguir aprendiendo sobre seguridad psicolÃ³gica? EscanÃ©ala y descubre mÃ¡s recursos e ideas.",
                faroBreathingItem: "<strong>ğŸ§˜ Pausa de RespiraciÃ³n</strong><br>Â¿Necesitas un momento para respirar antes de comenzar? Usa la pausa de respiraciÃ³n guiada para marcar el inicio y centrar la energÃ­a del grupo en el espacio virtual.",
                faroHowTitle: "ğŸª„ Â¿CÃ³mo se usa?",
                faroHowDesc: "Este kit estÃ¡ hecho para reuniones reales: cortas, con muchas ideas y poco tiempo.<br>No tienes que usar todo a la vez â€”elige lo que el equipo necesite ese dÃ­aâ€”.",
                faroStartTitle: "ğŸ’­ Â¿Vas a empezar una reuniÃ³n?",
                faroStartDesc: "Crea el ambiente. Usa la pausa de respiraciÃ³n para marcar el inicio y elige una carta con una pregunta o emociÃ³n.",
                faroDuringTitle: "ğŸ‘‚ Â¿EstÃ¡n en plena conversaciÃ³n?",
                faroDuringDesc: "ApÃ³yate en las tarjetas de colores o en las cartas de la verdad. Sirven para expresar, pedir la palabra o aclarar ideas sin romper la armonÃ­a.",
                faroEndTitle: "ğŸ’– Â¿Es momento de cerrar?",
                faroEndDesc: "TÃ³mate un minuto para agradecer o reconocer algo positivo. Usa el tablero o una carta de cierre para reflexionar sobre lo aprendido.",
                faroRememberTitle: "ğŸ’¡ Recuerda",
                faroRememberDesc: "Usar el kit no es cambiar la forma de trabajar, sino mejorar cÃ³mo nos escuchamos. Con el tiempo, estas pequeÃ±as acciones hacen que las reuniones sean mÃ¡s seguras, mÃ¡s humanas y mucho mÃ¡s efectivas.",
                
                // Modal content - Bloom
                bloomTitle: "ğŸ§ Seguridad PsicolÃ³gica en Bloom",
                bloomDesc1: "AmplÃ­a tus conocimientos sobre seguridad psicolÃ³gica con nuestros recursos y cursos en Bloom.",
                bloomClick: "Haz clic para acceder a los recursos",
                bloomDesc2: "Descubre herramientas, cursos y recursos para crear espacios donde todos se sientan seguros para compartir ideas y aprender de los errores.",
                
                // Notifications
                translationComplete: "âœ… TraducciÃ³n completada",
                voiceReaderActivated: "ğŸ”Š Lector de voz activado",
                voiceReaderDeactivated: "ğŸ”Š Lector de voz desactivado",
                musicActivated: "ğŸµ MÃºsica ambiental activada",
                musicStopped: "ğŸµ MÃºsica detenida",
                cardCopied: "âœ… Copiado: ",
                errorCopying: "âŒ Error al copiar",
                cardsShuffled: "ğŸ”€ Cartas mezcladas",
                recognitionAdded: "âœ… Reconocimiento agregado",
                errorSaving: "âŒ Error al guardar",
                deleted: "ğŸ—‘ï¸ Eliminado",
                errorDeleting: "âŒ Error al eliminar",
                breathing: "ğŸ§˜ Respira... Inhala... Exhala...",
                
                // Voice messages
                voiceWelcome: "Lector de voz activado. Kit de Seguridad PsicolÃ³gica. Usa las teclas de flecha o Tab para navegar entre elementos. Presiona Enter para escuchar cualquier elemento.",
                voiceMeetingPhase: "SecciÃ³n: Fase de la ReuniÃ³n. AquÃ­ puedes seleccionar en quÃ© momento de la reuniÃ³n estÃ¡s: Inicio, Durante, o Cierre.",
                voiceColorCards: "SecciÃ³n: Tarjetas de Colores. Usa estas tarjetas para expresar tu estado sin interrumpir: Verde para escuchar, Amarillo para preguntar, Naranja para reformular.",
                voiceQuickActions: "SecciÃ³n: Acciones RÃ¡pidas. AquÃ­ encontrarÃ¡s herramientas como Pausa de RespiraciÃ³n, El Faro y acceso al curso Bloom.",
                voiceTruthCards: "SecciÃ³n: Cartas de la Verdad. PequeÃ±as frases para grandes conversaciones. Haz clic en cualquier carta para copiarla.",
                voiceRecognition: "SecciÃ³n: Tablero de Reconocimiento. Escribe agradecimientos para fortalecer la confianza del equipo."
            },
            en: {
                // Main page elements
                title: "ğŸ§  Psychological Safety Kit",
                subtitle: "Small gestures for great conversations",
                boatText: "Sailing together towards safer conversations",
                phaseTitle: "ğŸ“ Meeting Phase",
                phaseDesc: "You don't have to use everything at once â€” choose what the team needs that day",
                phaseStart: "ğŸŸ¢ Start",
                phaseDuring: "ğŸŸ¡ During",
                phaseEnd: "ğŸ”µ Closing",
                colorCardsTitle: "ğŸŒˆ Color Cards",
                colorCardsDesc: "Want to say something without interrupting? Use a card to keep the conversation smooth and respectful",
                greenCard: "Green",
                greenDesc: "I'm listening carefully",
                yellowCard: "Yellow",
                yellowDesc: "I have a question",
                orangeCard: "Orange",
                orangeDesc: "Let's rephrase this",
                quickActions: "âš¡ Quick Actions",
                breathBtn: "ğŸ§˜ Breathing Pause",
                faroBtn: "ğŸŒŸ The Lighthouse - Your Guide",
                bloomBtn: "ğŸ“± Bloom Course",
                truthCardsTitle: "ğŸƒ Truth Cards",
                truthCardsDesc: "Small phrases for big conversations. Click to copy to clipboard",
                btnAll: "ğŸ“š View All",
                btnCurrent: "ğŸ¯ Current Phase",
                btnShuffle: "ğŸ”€ Shuffle",
                recognitionTitle: "ğŸ’Œ Recognition Board",
                recognitionDesc: "At the end of the meeting, write a small thank you. Small gestures strengthen trust and team spirit.",
                recognitionPlaceholder: 'Ex: "Thank you for listening patiently"',
                addBtn: "Add ğŸ’š",
                deleteBtn: "ğŸ—‘ï¸ Delete",
                closeBtn: "Close",
                noRecognitions: "No recognitions yet. Be the first!",
                
                // Questions
                q1: "How do we feel today?",
                q2: "What's something small that made you smile this week?",
                q3: "What is the goal of our meeting?",
                q4: "Have we heard all points of view?",
                q5: "Are we making ourselves understood?",
                q6: "Do we need an example to understand better?",
                q7: "What is the idea I take from this conversation?",
                q8: "What do we appreciate about how we listened today?",
                q9: "What tasks do we take to keep moving forward?",
                
                // Breathing section
                breathTitle: "ğŸ§˜ Breathing Pause",
                breathText: "Breathe in deeply... Exhale slowly...",
                breathDesc: "Take a moment to center your energy",
                
                // Modal content - Faro
                faroTitle: "ğŸŒŸ The Lighthouse: your guide to creating safe spaces",
                faroWhatIsTitle: "What is The Lighthouse?",
                faroWhatIsDesc: "It's a small guide that helps you remember why the kit exists, how to use it, and how each element can help you care for the group's psychological safety.",
                faroWhyTitle: "ğŸ’¬ Why does this kit exist?",
                faroWhyDesc1: "Because at Takeda we believe that psychological safety doesn't come from big speeches, but from small gestures: how we listen, how we ask questions, and how we give space to others' ideas.",
                faroWhyDesc2: "This kit is here to accompany you in those moments, strengthen trust, and create meetings where everyone can speak with freedom, respect, and serenity.",
                faroContainsTitle: "ğŸ What does it contain?",
                faroContainsDesc: "Each element has a special purpose:",
                faroColorCardsItem: "<strong>ğŸŒˆ Color cards</strong><br>Want to say something without interrupting? Use a card. They help keep the conversation smooth and respectful.",
                faroTruthCardsItem: "<strong>ğŸ’Œ Truth cards</strong><br>Feel like your team needs to reflect or empathize? Choose a card: each one invites thinking and connecting from emotion.",
                faroRecognitionItem: "<strong>â­ Recognition board</strong><br>Want to close with gratitude? Write a thank you or something positive you noticed during the meeting. Recognizing strengthens trust!",
                faroBloomItem: "<strong>ğŸ“± Bloom QR card</strong><br>Would you like to continue learning about psychological safety? Scan it and discover more resources and ideas.",
                faroBreathingItem: "<strong>ğŸ§˜ Breathing Pause</strong><br>Need a moment to breathe before starting? Use the guided breathing pause to mark the beginning and center the group's energy in the virtual space.",
                faroHowTitle: "ğŸª„ How is it used?",
                faroHowDesc: "This kit is made for real meetings: short, with many ideas and little time.<br>You don't have to use everything at once â€”choose what the team needs that dayâ€”.",
                faroStartTitle: "ğŸ’­ Are you starting a meeting?",
                faroStartDesc: "Set the atmosphere. Use the breathing pause to mark the beginning and choose a card with a question or emotion.",
                faroDuringTitle: "ğŸ‘‚ Are you in the middle of a conversation?",
                faroDuringDesc: "Rely on the color cards or truth cards. They help you express yourself, ask to speak, or clarify ideas without breaking the harmony.",
                faroEndTitle: "ğŸ’– Is it time to wrap up?",
                faroEndDesc: "Take a minute to thank someone or recognize something positive. Use the board or a closing card to reflect on what was learned.",
                faroRememberTitle: "ğŸ’¡ Remember",
                faroRememberDesc: "Using the kit isn't about changing how we work, but improving how we listen to each other. Over time, these small actions make meetings safer, more human, and much more effective.",
                
                // Modal content - Bloom
                bloomTitle: "ğŸ§ Psychological Safety in Bloom",
                bloomDesc1: "Expand your knowledge about psychological safety with our resources and courses in Bloom.",
                bloomClick: "Click to access the resources",
                bloomDesc2: "Discover tools, courses, and resources to create spaces where everyone feels safe to share ideas and learn from mistakes.",
                
                // Notifications
                translationComplete: "âœ… Translation completed",
                voiceReaderActivated: "ğŸ”Š Voice reader activated",
                voiceReaderDeactivated: "ğŸ”Š Voice reader deactivated",
                musicActivated: "ğŸµ Ambient music activated",
                musicStopped: "ğŸµ Music stopped",
                cardCopied: "âœ… Copied: ",
                errorCopying: "âŒ Error copying",
                cardsShuffled: "ğŸ”€ Cards shuffled",
                recognitionAdded: "âœ… Recognition added",
                errorSaving: "âŒ Error saving",
                deleted: "ğŸ—‘ï¸ Deleted",
                errorDeleting: "âŒ Error deleting",
                breathing: "ğŸ§˜ Breathe... Inhale... Exhale...",
                
                // Voice messages
                voiceWelcome: "Voice reader activated. Psychological Safety Kit. Use arrow keys or Tab to navigate between elements. Press Enter to hear any element.",
                voiceMeetingPhase: "Section: Meeting Phase. Here you can select which moment of the meeting you're in: Start, During, or Closing.",
                voiceColorCards: "Section: Color Cards. Use these cards to express your state without interrupting: Green for listening, Yellow for asking, Orange for rephrasing.",
                voiceQuickActions: "Section: Quick Actions. Here you'll find tools like Breathing Pause, The Lighthouse, and access to the Bloom course.",
                voiceTruthCards: "Section: Truth Cards. Small phrases for big conversations. Click on any card to copy it.",
                voiceRecognition: "Section: Recognition Board. Write acknowledgments to strengthen team trust."
            }
        };

        // Sound effects using Web Audio API
        let audioContext;
        try {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
            console.warn('Web Audio API not supported:', e);
        }
        
        // Background music generator
        let musicOscillators = [];
        let musicGainNode = null;
        let isMusicPlaying = false;
        
        // Text-to-speech voice reader
        let isVoiceReading = false;
        let currentUtterance = null;
        let currentLanguage = 'es-ES';
        
        function getLanguageCode(lang) {
            const langMap = {
                'es': 'es-ES',
                'en': 'en-US',
                'pt': 'pt-BR',
                'fr': 'fr-FR',
                'de': 'de-DE',
                'ja': 'ja-JP',
                'zh': 'zh-CN'
            };
            return langMap[lang] || 'es-ES';
        }
        
        // Phase labels object - will be updated when language changes
        let phaseLabels = { 
            inicio: 'ğŸŸ¢ Inicio', 
            durante: 'ğŸŸ¡ Durante', 
            cierre: 'ğŸ”µ Cierre' 
        };
        
        // FunciÃ³n auxiliar para obtener texto traducido
        function getTranslatedText(key) {
            const currentLang = currentLanguage.split('-')[0];
            const t = translations[currentLang] || translations.es;
            return t[key] || key;
        }
        
        // FunciÃ³n auxiliar para mostrar notificaciones traducidas
        function showTranslatedNotification(key) {
            const text = getTranslatedText(key);
            showNotification(text);
        }
        
        function translatePage(lang) {
            const t = translations[lang];
            if (!t) return;
            
            playSound('click');
            showNotification(t.translationComplete);
            
            // Update selected option
            document.querySelectorAll('.language-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`[data-lang="${lang}"]`).classList.add('selected');
            
            // Close menu
            document.getElementById('languageMenu').classList.remove('active');
            
            // Translate main elements
            document.querySelector('h1').textContent = t.title;
            document.querySelector('.subtitle').textContent = t.subtitle;
            document.querySelector('.boat-text').textContent = t.boatText;
            
            // Phase section
            document.querySelector('.meeting-phase h2').textContent = t.phaseTitle;
            document.querySelector('.meeting-phase p').textContent = t.phaseDesc;
            
            // Update the colored phase buttons
            const phaseButtons = document.querySelectorAll('.phase-btn');
            phaseButtons[0].textContent = t.phaseStart;
            phaseButtons[1].textContent = t.phaseDuring;
            phaseButtons[2].textContent = t.phaseEnd;
            
            // Also update the phase labels used in question cards
            phaseLabels.inicio = t.phaseStart;
            phaseLabels.durante = t.phaseDuring;
            phaseLabels.cierre = t.phaseEnd;
            
            // Color cards
            document.querySelector('.voice-meter h2').textContent = t.colorCardsTitle;
            document.querySelector('.voice-meter p').textContent = t.colorCardsDesc;
            document.querySelectorAll('.card-title')[0].textContent = t.greenCard;
            document.querySelectorAll('.card-desc')[0].textContent = t.greenDesc;
            document.querySelectorAll('.card-title')[1].textContent = t.yellowCard;
            document.querySelectorAll('.card-desc')[1].textContent = t.yellowDesc;
            document.querySelectorAll('.card-title')[2].textContent = t.orangeCard;
            document.querySelectorAll('.card-desc')[2].textContent = t.orangeDesc;
            
            // Quick actions
            document.querySelector('.quick-actions h2').textContent = t.quickActions;
            document.querySelectorAll('.action-btn')[0].textContent = t.breathBtn;
            document.querySelectorAll('.action-btn')[1].textContent = t.faroBtn;
            document.querySelectorAll('.action-btn')[2].textContent = t.bloomBtn;
            
            // Truth cards
            document.querySelector('.truth-cards-section h2').textContent = t.truthCardsTitle;
            document.querySelector('.truth-cards-section > p').textContent = t.truthCardsDesc;
            document.querySelectorAll('.mode-btn')[0].textContent = t.btnAll;
            document.querySelectorAll('.mode-btn')[1].textContent = t.btnCurrent;
            document.querySelectorAll('.mode-btn')[2].textContent = t.btnShuffle;
            
            // Recognition
            document.querySelector('.recognition-section h2').textContent = t.recognitionTitle;
            document.querySelector('.recognition-section > p').textContent = t.recognitionDesc;
            document.getElementById('recognitionInput').placeholder = t.recognitionPlaceholder;
            document.getElementById('addBtn').textContent = t.addBtn;
            
            // Breathing message
            document.getElementById('breathTitle').textContent = t.breathTitle;
            document.getElementById('breathText').textContent = t.breathText;
            document.getElementById('breathDesc').textContent = t.breathDesc;
            
            // Update close buttons in modals
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.textContent = t.closeBtn;
            });
            
            // Update questions
            questions.inicio = [t.q1, t.q2, t.q3];
            questions.durante = [t.q4, t.q5, t.q6];
            questions.cierre = [t.q7, t.q8, t.q9];
            updateQuestions();
            
            // Update delete buttons
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.textContent = t.deleteBtn;
            });
            
            // Update modal content
            updateModalContent(t);
            
            currentLanguage = getLanguageCode(lang);
            
            // Save language preference
            localStorage.setItem('takedaLanguage', lang);
            
            // Re-apply voice reading if it's active
            if (isVoiceReading) {
                // First disable to clean up
                disableVoiceReading();
                // Then re-enable to apply to new content
                setTimeout(() => {
                    enableVoiceReading();
                    showNotification(t.voiceReaderActivated);
                }, 100);
            }
            
            setTimeout(() => {
                playSound('success');
            }, 500);
        }
        
        function updateModalContent(t) {
            // Update Faro modal
            const faroModal = document.getElementById('faroModal');
            faroModal.querySelector('h3').textContent = t.faroTitle;
            
            // Update Faro modal content with IDs
            document.getElementById('faroWhatIsTitle').textContent = t.faroWhatIsTitle;
            document.getElementById('faroWhatIsDesc').textContent = t.faroWhatIsDesc;
            document.getElementById('faroWhyTitle').textContent = t.faroWhyTitle;
            document.getElementById('faroWhyDesc1').textContent = t.faroWhyDesc1;
            document.getElementById('faroWhyDesc2').textContent = t.faroWhyDesc2;
            document.getElementById('faroContainsTitle').textContent = t.faroContainsTitle;
            document.getElementById('faroContainsDesc').textContent = t.faroContainsDesc;
            
            // Update kit items
            document.getElementById('faroColorCardsItem').innerHTML = t.faroColorCardsItem;
            document.getElementById('faroTruthCardsItem').innerHTML = t.faroTruthCardsItem;
            document.getElementById('faroRecognitionItem').innerHTML = t.faroRecognitionItem;
            document.getElementById('faroBloomItem').innerHTML = t.faroBloomItem;
            document.getElementById('faroBreathingItem').innerHTML = t.faroBreathingItem;
            
            // Update how to use section
            document.getElementById('faroHowTitle').textContent = t.faroHowTitle;
            document.getElementById('faroHowDesc').innerHTML = t.faroHowDesc;
            document.getElementById('faroStartTitle').textContent = t.faroStartTitle;
            document.getElementById('faroStartDesc').textContent = t.faroStartDesc;
            document.getElementById('faroDuringTitle').textContent = t.faroDuringTitle;
            document.getElementById('faroDuringDesc').textContent = t.faroDuringDesc;
            document.getElementById('faroEndTitle').textContent = t.faroEndTitle;
            document.getElementById('faroEndDesc').textContent = t.faroEndDesc;
            document.getElementById('faroRememberTitle').textContent = t.faroRememberTitle;
            document.getElementById('faroRememberDesc').textContent = t.faroRememberDesc;
            
            // Update Bloom modal
            document.getElementById('bloomTitle').textContent = t.bloomTitle;
            document.getElementById('bloomDesc1').textContent = t.bloomDesc1;
            document.getElementById('bloomClick').textContent = t.bloomClick;
            document.getElementById('bloomDesc2').textContent = t.bloomDesc2;
        }
        
        function toggleLanguageMenu() {
            const menu = document.getElementById('languageMenu');
            menu.classList.toggle('active');
            playSound('click');
        }
        
        function changeLanguage(lang) {
            translatePage(lang);
        }
        
        // Close language menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('languageMenu');
            const icon = document.getElementById('languageIcon');
            if (menu && icon && !menu.contains(event.target) && event.target !== icon) {
                menu.classList.remove('active');
            }
        });
        
        function speakText(text) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = currentLanguage;
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 0.8;
                
                // Wait for voices to be loaded
                const voices = window.speechSynthesis.getVoices();
                if (voices.length > 0) {
                    const matchingVoice = voices.find(voice => 
                        voice.lang.startsWith(currentLanguage.split('-')[0])
                    );
                    if (matchingVoice) {
                        utterance.voice = matchingVoice;
                    }
                } else {
                    // If voices aren't loaded yet, try again after a short delay
                    setTimeout(() => {
                        const voices = window.speechSynthesis.getVoices();
                        const matchingVoice = voices.find(voice => 
                            voice.lang.startsWith(currentLanguage.split('-')[0])
                        );
                        if (matchingVoice) {
                            utterance.voice = matchingVoice;
                        }
                        window.speechSynthesis.speak(utterance);
                    }, 100);
                    return;
                }
                
                utterance.onend = function() {
                    const icon = document.getElementById('voiceIcon');
                    if (icon) icon.classList.remove('speaking');
                };
                
                utterance.onerror = function(event) {
                    console.error('Speech synthesis error:', event);
                    const icon = document.getElementById('voiceIcon');
                    if (icon) icon.classList.remove('speaking');
                };
                
                currentUtterance = utterance;
                window.speechSynthesis.speak(utterance);
                
                const icon = document.getElementById('voiceIcon');
                if (icon) icon.classList.add('speaking');
            }
        }
        
        function toggleVoiceReader() {
            const icon = document.getElementById('voiceIcon');
            const currentLang = currentLanguage.split('-')[0];
            const t = translations[currentLang] || translations.es;
            
            if (!isVoiceReading) {
                isVoiceReading = true;
                icon.textContent = 'ğŸ”‡';
                playSound('success');
                
                // Usar la notificaciÃ³n traducida
                showNotification(t.voiceReaderActivated);
                
                // Leer mensaje de bienvenida en el idioma correcto
                speakText(t.voiceWelcome);
                
                // Add click listeners to readable content
                enableVoiceReading();
            } else {
                isVoiceReading = false;
                icon.textContent = 'ğŸ”Š';
                icon.classList.remove('speaking');
                window.speechSynthesis.cancel();
                playSound('click');
                
                // Usar la notificaciÃ³n traducida
                showNotification(t.voiceReaderDeactivated);
                
                // Remove click listeners
                disableVoiceReading();
            }
        }
        
        function enableVoiceReading() {
            // Make all text readable with proper ARIA labels
            const readableElements = document.querySelectorAll('h1, h2, h3, h4, p, .card-desc, .card-title, .question-card, .recognition-text, .boat-text, .subtitle, .kit-item, button:not(.delete-btn), .voice-card, .phase-btn, .mode-btn');
            
            readableElements.forEach((element, index) => {
                if (element.getAttribute('data-voice-enabled') === 'true') return; // Skip if already enabled
                
                element.style.cursor = 'pointer';
                element.setAttribute('data-voice-enabled', 'true');
                element.setAttribute('tabindex', '0');
                element.setAttribute('role', 'button');
                
                // Add descriptive aria-label
                if (!element.getAttribute('aria-label-original')) {
                    let description = element.textContent.trim();
                    if (element.classList.contains('question-card')) {
                        description = getTranslatedText('truthCardsTitle') + ': ' + description;
                    } else if (element.classList.contains('voice-card')) {
                        description = getTranslatedText('colorCardsTitle') + ': ' + description;
                    } else if (element.classList.contains('phase-btn')) {
                        description = getTranslatedText('phaseTitle') + ': ' + description;
                    } else if (element.tagName === 'H1') {
                        description = 'TÃ­tulo principal: ' + description;
                    } else if (element.tagName === 'H2') {
                        description = 'SecciÃ³n: ' + description;
                    } else if (element.tagName === 'BUTTON') {
                        description = 'BotÃ³n: ' + description;
                    }
                    element.setAttribute('aria-label-original', description);
                    element.setAttribute('aria-label', description);
                }
                
                const clickHandler = function(e) {
                    handleVoiceClick.call(this, e);
                };
                
                const keyHandler = function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        handleVoiceClick.call(this, e);
                    }
                };
                
                element.addEventListener('click', clickHandler);
                element.addEventListener('keypress', keyHandler);
                
                // Store handlers for cleanup
                element._voiceClickHandler = clickHandler;
                element._voiceKeyHandler = keyHandler;
            });
            
            // Add section navigation announcements
            addSectionAnnouncements();
        }
        
        function addSectionAnnouncements() {
            // Announce when entering different sections
            const currentLang = currentLanguage.split('-')[0];
            const t = translations[currentLang] || translations.es;
            
            const sections = [
                { selector: '.meeting-phase', text: t.voiceMeetingPhase },
                { selector: '.voice-meter', text: t.voiceColorCards },
                { selector: '.quick-actions', text: t.voiceQuickActions },
                { selector: '.truth-cards-section', text: t.voiceTruthCards },
                { selector: '.recognition-section', text: t.voiceRecognition }
            ];
            
            sections.forEach(section => {
                const element = document.querySelector(section.selector);
                if (element) {
                    element.setAttribute('aria-label', section.text);
                    element.setAttribute('tabindex', '0');
                    element.addEventListener('focus', function() {
                        if (isVoiceReading) {
                            speakText(section.text);
                        }
                    });
                }
            });
        }
        
        function disableVoiceReading() {
            const readableElements = document.querySelectorAll('[data-voice-enabled="true"]');
            
            readableElements.forEach(element => {
                element.style.cursor = '';
                element.removeAttribute('data-voice-enabled');
                element.removeAttribute('tabindex');
                element.removeAttribute('role');
                
                // Remove event listeners using stored handlers
                if (element._voiceClickHandler) {
                    element.removeEventListener('click', element._voiceClickHandler);
                    delete element._voiceClickHandler;
                }
                if (element._voiceKeyHandler) {
                    element.removeEventListener('keypress', element._voiceKeyHandler);
                    delete element._voiceKeyHandler;
                }
            });
        }
        
        function handleVoiceClick(event) {
            if (isVoiceReading) {
                const ariaLabel = this.getAttribute('aria-label');
                const text = ariaLabel || this.textContent.trim();
                if (text) {
                    speakText(text);
                    playSound('click');
                    
                    // Visual feedback
                    this.style.outline = '3px solid #667eea';
                    setTimeout(() => {
                        this.style.outline = '';
                    }, 1000);
                }
            }
        }
        
        // Load voices when available
        if ('speechSynthesis' in window) {
            window.speechSynthesis.onvoiceschanged = function() {
                window.speechSynthesis.getVoices();
            };
        }
        
        function createBackgroundMusic() {
            if (!audioContext) return;
            
            // Create master gain node
            musicGainNode = audioContext.createGain();
            musicGainNode.gain.value = 0;
            musicGainNode.connect(audioContext.destination);
            
            // Peaceful chord progression: C major - G major - A minor - F major
            const chordProgression = [
                [261.63, 329.63, 392.00], // C major (C-E-G)
                [392.00, 493.88, 587.33], // G major (G-B-D)
                [220.00, 261.63, 329.63], // A minor (A-C-E)
                [349.23, 440.00, 523.25]  // F major (F-A-C)
            ];
            
            let chordIndex = 0;
            
            function playChord() {
                if (!isMusicPlaying) return;
                
                const chord = chordProgression[chordIndex];
                const chordDuration = 4; // 4 seconds per chord
                
                chord.forEach((freq, index) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.value = freq;
                    
                    // Gentle fade in and out
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.08 - (index * 0.02), audioContext.currentTime + 0.5);
                    gainNode.gain.setValueAtTime(0.08 - (index * 0.02), audioContext.currentTime + chordDuration - 0.5);
                    gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + chordDuration);
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(musicGainNode);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + chordDuration);
                });
                
                // Add subtle bell-like overtone
                const bell = audioContext.createOscillator();
                const bellGain = audioContext.createGain();
                bell.type = 'sine';
                bell.frequency.value = chord[0] * 2;
                bellGain.gain.setValueAtTime(0, audioContext.currentTime);
                bellGain.gain.linearRampToValueAtTime(0.03, audioContext.currentTime + 0.1);
                bellGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 2);
                bell.connect(bellGain);
                bellGain.connect(musicGainNode);
                bell.start(audioContext.currentTime);
                bell.stop(audioContext.currentTime + 2);
                
                chordIndex = (chordIndex + 1) % chordProgression.length;
                
                if (isMusicPlaying) {
                    setTimeout(playChord, chordDuration * 1000);
                }
            }
            
            // Fade in master volume
            musicGainNode.gain.linearRampToValueAtTime(1, audioContext.currentTime + 2);
            
            // Start playing
            playChord();
        }
        
        function stopBackgroundMusic() {
            isMusicPlaying = false;
            if (musicGainNode) {
                musicGainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 1.5);
                setTimeout(() => {
                    if (musicGainNode) {
                        musicGainNode.disconnect();
                        musicGainNode = null;
                    }
                }, 1500);
            }
        }
        
        function toggleBackgroundMusic() {
            const icon = document.getElementById('musicIcon');
            const currentLang = currentLanguage.split('-')[0];
            const t = translations[currentLang] || translations.es;
            
            if (!isMusicPlaying) {
                isMusicPlaying = true;
                createBackgroundMusic();
                icon.classList.add('playing');
                icon.textContent = 'ğŸ”‡';
                showNotification(t.musicActivated);
                playSound('success');
            } else {
                stopBackgroundMusic();
                icon.classList.remove('playing');
                icon.textContent = 'ğŸµ';
                showNotification(t.musicStopped);
                playSound('click');
            }
        }
        
        function playSound(type) {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'click':
                    oscillator.frequency.value = 800;
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                    break;
                case 'success':
                    oscillator.frequency.value = 600;
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.1);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
                case 'delete':
                    oscillator.frequency.value = 400;
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start(audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.1);
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
                case 'breath':
                    oscillator.type = 'sine';
                    oscillator.frequency.value = 220;
                    gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(180, audioContext.currentTime + 0.5);
                    oscillator.stop(audioContext.currentTime + 1);
                    break;
                case 'shuffle':
                    for(let i = 0; i < 3; i++) {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.value = 600 + (i * 200);
                        gain.gain.setValueAtTime(0.1, audioContext.currentTime + (i * 0.05));
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + (i * 0.05) + 0.1);
                        osc.start(audioContext.currentTime + (i * 0.05));
                        osc.stop(audioContext.currentTime + (i * 0.05) + 0.1);
                    }
                    break;
            }
        }
        
        const questions = {
            inicio: ["Â¿CÃ³mo nos sentimos hoy?", "Â¿QuÃ© es algo pequeÃ±o que te hizo sonreÃ­r esta semana?", "Â¿CuÃ¡l es el objetivo de nuestra reuniÃ³n?"],
            durante: ["Â¿Ya escuchamos todos los puntos de vista?", "Â¿Nos estamos haciendo entender?", "Â¿Necesitamos algÃºn ejemplo para entender mejor?"],
            cierre: ["Â¿CuÃ¡l es la idea que me llevo de la conversaciÃ³n?", "Â¿QuÃ© apreciamos de cÃ³mo nos escuchamos hoy?", "Â¿QuÃ© tareas nos llevamos para seguir avanzando?"]
        };
        
        let currentPhase = 'inicio', cardDisplayMode = 'all';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved language preference or detect browser language
            const savedLanguage = localStorage.getItem('takedaLanguage');
            const browserLang = navigator.language.substring(0, 2);
            const supportedLangs = ['es', 'en', 'pt', 'fr', 'de', 'ja', 'zh'];
            
            let initialLang = 'es'; // Default to Spanish
            
            if (savedLanguage && supportedLangs.includes(savedLanguage)) {
                initialLang = savedLanguage;
            } else if (supportedLangs.includes(browserLang)) {
                initialLang = browserLang;
            }
            
            // Apply initial language
            translatePage(initialLang);
            
            updateQuestions();
            loadRecognitions();
            document.getElementById('recognitionInput').addEventListener('keypress', e => { if (e.key === 'Enter') addRecognition(); });
        });
        
        function setPhase(phase) {
            playSound('click');
            currentPhase = phase;
            document.querySelectorAll('.phase-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateQuestions();
        }
        
        function setCardMode(mode) {
            playSound('click');
            cardDisplayMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateQuestions();
        }
        
        function updateQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            let questionsToShow = [];
            
            if (cardDisplayMode === 'current') {
                questions[currentPhase].forEach((q, i) => questionsToShow.push({ text: q, phase: currentPhase }));
            } else {
                Object.keys(questions).forEach(phase => questions[phase].forEach(q => questionsToShow.push({ text: q, phase: phase })));
            }
            
            questionsToShow.forEach(q => {
                const card = document.createElement('div');
                card.className = `question-card ${q.phase}`;
                const badge = document.createElement('div');
                badge.className = `question-phase-badge ${q.phase}`;
                badge.textContent = phaseLabels[q.phase];
                const text = document.createElement('div');
                text.textContent = q.text;
                text.style.paddingTop = '25px';
                card.appendChild(badge);
                card.appendChild(text);
                
                // Add click handler for copying to clipboard
                card.onclick = () => { 
                    playSound('click');
                    const currentLang = currentLanguage.split('-')[0];
                    const t = translations[currentLang] || translations.es;
                    
                    navigator.clipboard.writeText(q.text).then(() => {
                        const notificationText = t.cardCopied + q.text.substring(0, 30) + '...';
                        showNotification(notificationText);
                        
                        // TambiÃ©n hablar lo que se copiÃ³ si el lector de voz estÃ¡ activo
                        if (isVoiceReading) {
                            speakText(notificationText);
                        }
                    }).catch(() => {
                        showNotification(t.errorCopying);
                        
                        if (isVoiceReading) {
                            speakText(t.errorCopying);
                        }
                    });
                };
                
                // Apply voice reading if it's active
                if (isVoiceReading) {
                    applyVoiceReadingToElement(card);
                }
                
                container.appendChild(card);
            });
        }
        
        // New function to apply voice reading to individual elements
        function applyVoiceReadingToElement(element) {
            if (element.getAttribute('data-voice-enabled') === 'true') return; // Skip if already enabled
            
            element.style.cursor = 'pointer';
            element.setAttribute('data-voice-enabled', 'true');
            element.setAttribute('tabindex', '0');
            element.setAttribute('role', 'button');
            
            // Add descriptive aria-label
            if (!element.getAttribute('aria-label-original')) {
                let description = element.textContent.trim();
                if (element.classList.contains('question-card')) {
                    description = getTranslatedText('truthCardsTitle') + ': ' + description;
                } else if (element.classList.contains('voice-card')) {
                    description = getTranslatedText('colorCardsTitle') + ': ' + description;
                } else if (element.classList.contains('phase-btn')) {
                    description = getTranslatedText('phaseTitle') + ': ' + description;
                } else if (element.tagName === 'H1') {
                    description = 'TÃ­tulo principal: ' + description;
                } else if (element.tagName === 'H2') {
                    description = 'SecciÃ³n: ' + description;
                } else if (element.tagName === 'BUTTON') {
                    description = 'BotÃ³n: ' + description;
                }
                element.setAttribute('aria-label-original', description);
                element.setAttribute('aria-label', description);
            }
            
            const clickHandler = function(e) {
                handleVoiceClick.call(this, e);
            };
            
            const keyHandler = function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleVoiceClick.call(this, e);
                }
            };
            
            element.addEventListener('click', clickHandler);
            element.addEventListener('keypress', keyHandler);
            
            // Store handlers for cleanup
            element._voiceClickHandler = clickHandler;
            element._voiceKeyHandler = keyHandler;
        }
        
        function shuffleCards() {
            playSound('shuffle');
            const container = document.getElementById('questionsContainer');
            const cards = Array.from(container.children);
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            container.innerHTML = '';
            cards.forEach(card => container.appendChild(card));
            
            showTranslatedNotification('cardsShuffled');
        }
        
        async function loadRecognitions() {
            // For demo purposes, we'll use localStorage instead of Firebase
            const storedRecognitions = localStorage.getItem('takedaRecognitions');
            let items = [];
            
            if (storedRecognitions) {
                items = JSON.parse(storedRecognitions);
            }
            
            displayRecognitions(items);
        }
        
        function displayRecognitions(items) {
            const list = document.getElementById('recognitionList');
            const currentLang = currentLanguage.split('-')[0];
            const t = translations[currentLang] || translations.es;
            
            if (items.length === 0) {
                list.innerHTML = `<div style="text-align:center;padding:20px;font-style:italic;">${t.noRecognitions}</div>`;
                return;
            }
            list.innerHTML = '';
            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'recognition-item';
                const text = document.createElement('span');
                text.className = 'recognition-text';
                text.textContent = item.emoji + ' "' + item.text + '"';
                const btn = document.createElement('button');
                btn.className = 'delete-btn';
                btn.textContent = t.deleteBtn;
                btn.onclick = () => {
                    playSound('delete');
                    deleteRecognition(index);
                };
                div.appendChild(text);
                div.appendChild(btn);
                
                // Apply voice reading if it's active
                if (isVoiceReading) {
                    applyVoiceReadingToElement(div);
                    applyVoiceReadingToElement(text);
                }
                
                list.appendChild(div);
            });
        }
        
        async function addRecognition() {
            const input = document.getElementById('recognitionInput');
            const text = input.value.trim();
            if (!text) return;
            
            const btn = document.getElementById('addBtn');
            btn.disabled = true;
            
            try {
                const emojis = ['ğŸ’š', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«', 'ğŸ™Œ', 'ğŸ‘', 'ğŸ’™', 'ğŸ¯'];
                const emoji = emojis[Math.floor(Math.random() * emojis.length)];
                
                // Get existing recognitions
                const storedRecognitions = localStorage.getItem('takedaRecognitions');
                let items = storedRecognitions ? JSON.parse(storedRecognitions) : [];
                
                // Add new recognition
                items.push({
                    text: text,
                    emoji: emoji,
                    timestamp: Date.now()
                });
                
                // Save back to localStorage
                localStorage.setItem('takedaRecognitions', JSON.stringify(items));
                
                input.value = '';
                playSound('success');
                
                showTranslatedNotification('recognitionAdded');
                
                // Refresh the list
                loadRecognitions();
            } catch (e) {
                showTranslatedNotification('errorSaving');
                console.error('Error:', e);
            } finally {
                btn.disabled = false;
            }
        }
        
        async function deleteRecognition(index) {
            try {
                // Get existing recognitions
                const storedRecognitions = localStorage.getItem('takedaRecognitions');
                let items = storedRecognitions ? JSON.parse(storedRecognitions) : [];
                
                // Remove the item at the specified index
                items.splice(index, 1);
                
                // Save back to localStorage
                localStorage.setItem('takedaRecognitions', JSON.stringify(items));
                
                showTranslatedNotification('deleted');
                
                // Refresh the list
                loadRecognitions();
            } catch (e) {
                showTranslatedNotification('errorDeleting');
                console.error('Error:', e);
            }
        }
        
        function selectVoiceCard(card, color) {
            playSound('click');
            document.querySelectorAll('.voice-card').forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
            
            const currentLang = currentLanguage.split('-')[0];
            const t = translations[currentLang] || translations.es;
            
            const msgs = {
                green: t.greenCard + ': ' + t.greenDesc,
                yellow: t.yellowCard + ': ' + t.yellowDesc,
                orange: t.orangeCard + ': ' + t.orangeDesc
            };
            
            showNotification(msgs[color]);
            
            // TambiÃ©n hablar la descripciÃ³n
            if (isVoiceReading) {
                speakText(msgs[color]);
            }
        }
        
        function activateBreathing() {
            playSound('breath');
            const effect = document.getElementById('breathingEffect');
            const message = document.getElementById('breathingMessage');
            effect.classList.add('active');
            message.classList.add('active');
            
            showTranslatedNotification('breathing');
            
            setTimeout(() => {
                effect.classList.remove('active');
                message.classList.remove('active');
            }, 8000);
        }
        
        function showFaro() { 
            playSound('click');
            document.getElementById('faroModal').classList.add('active'); 
        }
        function showBloom() { 
            playSound('click');
            document.getElementById('bloomModal').classList.add('active'); 
        }
        function closeModal(id) { 
            playSound('click');
            document.getElementById(id).classList.remove('active'); 
        }
        
        function showNotification(msg) {
            const n = document.createElement('div');
            n.style.cssText = 'position:fixed;top:20px;right:20px;background:linear-gradient(135deg,#56ab2f 0%,#a8e063 100%);color:white;padding:15px 25px;border-radius:10px;box-shadow:0 5px 20px rgba(0,0,0,0.3);z-index:2000;';
            n.textContent = msg;
            document.body.appendChild(n);
            setTimeout(() => n.remove(), 2000);
        }
        
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', e => { if (e.target === modal) modal.classList.remove('active'); });
        });
    </script>
</body>
</html>

